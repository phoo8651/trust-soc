mkdir -p /home/last/lastagent/debug
cd /home/last/lastagent/debug

nano test_register.py

#!/usr/bin/env python3
import json
import socket
import requests

CONTROLLER_HOST = "192.168.67.131"
NODEPORT = 30080
REGISTER_URL = f"http://{CONTROLLER_HOST}:{NODEPORT}/auth/register"

CLIENT_ID = "default"
AGENT_VERSION = "1"  # 서버가 string 기대

def main():
    # host: 서버 쪽 요구사항에 맞게 IP 또는 hostname
    try:
        host_ip = socket.gethostbyname(socket.gethostname())
    except Exception:
        host_ip = socket.gethostname()

    payload = {
        "client_id": CLIENT_ID,
        "host": host_ip,
        "agent_version": AGENT_VERSION,
    }

    print("[*] POST", REGISTER_URL)
    print("[*] payload:", json.dumps(payload))

    resp = requests.post(REGISTER_URL, json=payload)
    print("[*] status:", resp.status_code)
    print("[*] body:", resp.text)

    if resp.status_code not in (200, 201):
        print("[!] /auth/register 실패")
        return

    try:
        data = resp.json()
    except Exception:
        print("[!] JSON 파싱 실패")
        return

    agent_id = data.get("agent_id")
    access_token = data.get("access_token")
    refresh_token = data.get("refresh_token")
    expires_in = data.get("expires_in")

    print("[+] agent_id      :", agent_id)
    print("[+] access_token  :", access_token)
    print("[+] refresh_token :", refresh_token)
    print("[+] expires_in    :", expires_in)

if __name__ == "__main__":
    main()

cd /home/last/lastagent/debug
python3 test_register.py
